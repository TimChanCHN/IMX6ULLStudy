# 2 C语言编程实验
## 1. 实验目的
    通过该实验，了解在imx6ull中，如何利用汇编文件、c文件、makefile来构建一个C语言项目。同时还可以利用链接脚本，来简化项目编写流程。代码是以led闪烁实验。

## 2. 代码编写
1. 启动引导代码start.s编写
   1. 具体代码见`led_c`文件夹
   2. 该代码的关键是设置寄存器cpsr为SVC模式，同时设置好堆栈指针SP，堆栈指针设置不好的话，可能会令其跳出内存地址
2. 源代码编写
   1. 具体代码见`led_c`文件夹
3. Makefile编写
   1. 该工程同时包含了汇编代码和C代码，而在程序执行的过程中，必须先执行start.s，因此在makefile中，必须要先令start.s编译，可以通过查看反汇编文件.dis中，start.s是否首先执行，否则肯定有问题
   2. 在makefile中的`%.o:%.s`，如果添加了选项-O2,有可能导致在反汇编文件中，start.s并不是在链接地址上，需要删除该选项。
4. 链接脚本
   1. 见该例子
   ```
    SECTIONS{
        . = 0x87800000;                 # . 和 = 之间要有空格
        .text :                         # .text 和 ：之间要有空格
        {   
            start.o                     # start.o放前面，意味着start.o先编译
            *(.text)                    # *(.text)工程的剩下代码
        }
        .rodata ALIGN(4) : {*(.rodata*)}
        .data ALIGN(4) : {*(.data)}
        __bss_start=.;
        .bss ALIGN(4) : {*(.bss) *(COMMON)}
        __bss_end=.;
    }
   ```
   2. 在链接脚本中, 符号`.`是指定位计数器，指定在内存中的特定位置；在连接脚本中，.以及其后面的字串需要与=/:之间有空格；
   3. 在Makefile需要用到链接脚本的话，则需要把选项`-Ttext`改为`-Tfilename`.
   4. __bss_start/__bss_end在uboot/kernel中经常使用，可以用于计算bss段大小
   5. 链接脚本需要以.lds为后缀